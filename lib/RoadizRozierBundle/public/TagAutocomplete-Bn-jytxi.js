var a=Object.defineProperty;var c=(i,e,t)=>e in i?a(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var h=(i,e,t)=>c(i,typeof e!="symbol"?e+"":e,t);class l extends HTMLElement{constructor(){super();h(this,"handleOutsideClick",t=>{t.target.closest(".ui-autocomplete")||this.removeAutocompleteMenu()});this.debounce=null,this.input=this.querySelector(".rz-tag-autocomplete"),this.onInput=this.onInput.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.resize=this.resize.bind(this)}get value(){return this.input?this.input.value:""}get searchPath(){return this.getAttribute("data-search-path")}get csrfToken(){return this.getAttribute("data-csrf-token")}connectedCallback(){this.input&&(this.input.setAttribute("autocomplete","off"),this.input.addEventListener("keydown",this.onKeyDown),this.input.addEventListener("input",this.onInput),window.addEventListener("resize",this.resize))}disconnectedCallback(){this.input&&(this.input.removeEventListener("keydown",this.onKeyDown),this.input.removeEventListener("input",this.onInput),window.removeEventListener("resize",this.resize))}onKeyDown(t){t.keyCode===9&&this.input.dataset.menuActive==="true"&&t.preventDefault()}async onInput(t){const n=this.extractLast(this.value);if(n.length<2){this.removeAutocompleteMenu();return}const u={_action:"tagAutocomplete",_token:this.csrfToken,search:this.extractLast(n)},s=this.searchPath+"?"+new URLSearchParams(u);this.debounce&&(window.clearTimeout(this.debounce),this.debounce=null),this.debounce=window.setTimeout(async()=>{const r=await fetch(s,{headers:{"X-Requested-With":"XMLHttpRequest"}});this.showAutocompleteMenu(await r.json())},300)}showAutocompleteMenu(t){this.removeAutocompleteMenu();const n=document.createElement("ul");n.className="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front",t.forEach(u=>{const s=document.createElement("li");s.className="ui-menu-item",s.textContent=u,s.addEventListener("mousedown",r=>{r.preventDefault();let o=this.split(this.input.value);o.pop(),o.push(u),o.push(""),this.input.value=o.join(", "),this.removeAutocompleteMenu()}),n.appendChild(s)}),this.appendChild(n),this.input.dataset.menuActive="true",this.resize(),document.addEventListener("click",this.handleOutsideClick)}resize(){const t=this.querySelector(".ui-autocomplete");t&&(this.input.getBoundingClientRect(),t.style.left=`${this.input.offsetLeft}px`,t.style.top=`${this.input.offsetTop+this.input.offsetHeight}px`)}removeAutocompleteMenu(){const t=this.querySelector(".ui-autocomplete");t&&(t.remove(),document.removeEventListener("click",this.handleOutsideClick)),this.input&&(this.input.dataset.menuActive="false")}unbind(){}split(t){return t.split(/,\s*/)}extractLast(t){return this.split(t).pop()}}export{l as default};
