import{t as h}from"./main-DaRj3j6Q.js";import"./jquery-Cs7-jZ1a.js";import"./vue-BqDQd3Vv.js";class w extends HTMLElement{constructor(){super(),this.onInputKeyDown=this.onInputKeyDown.bind(this),this.onInputKeyUp=this.onInputKeyUp.bind(this),this.inputFocus=this.inputFocus.bind(this),this.inputFocusOut=this.inputFocusOut.bind(this),this.onFormSubmit=this.onFormSubmit.bind(this),this.wrapInTabs=this.wrapInTabs.bind(this),this.dropdown=null,this.form=this.querySelector("#edit-node-source-form"),this.formRow=this.querySelectorAll(".uk-form-row"),this.input=this.querySelectorAll("input, select"),this.devNames=this.querySelectorAll("[data-dev-name]")}connectedCallback(){this.form&&(this.wrapInTabs(),this.devNames.forEach(e=>{if(e.getAttribute("data-dev-name")!==""){const t=e.closest(".uk-form-row").querySelector("label"),s=e.querySelector(".uk-navbar-brand.label");t?t.insertAdjacentHTML("beforeend",'<span class="field-dev-name">'+e.getAttribute("data-dev-name")+"</span>"):s&&s.insertAdjacentHTML("beforeend",'<span class="field-dev-name">'+e.getAttribute("data-dev-name")+"</span>")}}),this.formRow.forEach((e,t)=>{e.className.indexOf("children-nodes-widget")>=0&&this.childrenNodeWidgetFlip(t)}),window.addEventListener("keydown",this.onInputKeyDown),window.addEventListener("keyup",this.onInputKeyUp),this.input.forEach(e=>{e.addEventListener("focus",this.inputFocus),e.addEventListener("focusout",this.inputFocusOut)}),this.form.addEventListener("submit",this.onFormSubmit))}disconnectedCallback(){this.form&&(window.removeEventListener("keydown",this.onInputKeyDown),window.removeEventListener("keyup",this.onInputKeyUp),this.input.forEach(e=>{e.removeEventListener("focus",this.inputFocus),e.removeEventListener("focusout",this.inputFocusOut)}),this.form.removeEventListener("submit",this.onFormSubmit))}wrapInTabs(){let e={default:{name:"default",id:"default",fields:[]}},t=this.querySelectorAll(".uk-form-row[data-field-group-canonical]");const s=t.length;let n=1;if(s<=0){this.classList.add("content-tabs-ready");return}for(let r=0;r<s;r++){let i=t[r].getAttribute("data-field-group"),o=t[r].getAttribute("data-field-group-canonical");o?(typeof e[o]>"u"&&(e[o]={name:i,id:o,fields:[]},n++),e[o].fields.push(t[r])):e.default.fields.push(t[r])}if(n>1){this.form.insertAdjacentHTML("beforeend",'<div id="node-source-form-switcher-nav-cont"><nav role="tablist" id="node-source-form-switcher-nav"></nav></div><ul id="node-source-form-switcher"></ul>');const r=this.form.querySelector("#node-source-form-switcher"),i=this.form.querySelector("#node-source-form-switcher-nav");for(let o in e){const a=e[o],c=a.id.replace(/[\s_]/g,"-").replace(/[^\w-]+/g,""),l="group-"+c,d="tab-"+c;r.insertAdjacentHTML("beforeend",'<li role="tabpanel" aria-labelledby="'+d+'" class="field-group" id="'+l+'"></li>'),a.id==="default"?i.insertAdjacentHTML("beforeend",'<button id="'+d+'" role="tab" class="switcher-nav-item" type="button" aria-controls="'+l+'"><i class="uk-icon-star"></i></button>'):i.insertAdjacentHTML("beforeend",'<button id="'+d+'" role="tab" class="switcher-nav-item" type="button" aria-controls="'+l+'">'+a.name+"</button>");let f=r.querySelector("#"+l);for(let u=0;u<a.fields.length;u++)f.appendChild(a.fields[u])}}this.activateTab(this.form.querySelector("#group-default")),this.activateTabNav(this.form.querySelector(".switcher-nav-item")),this.form.querySelectorAll(".switcher-nav-item").forEach(r=>{r.addEventListener("click",()=>{const i=r.getAttribute("aria-controls");this.form.querySelectorAll(".switcher-nav-item").forEach(o=>this.desactivateTabNav(o)),this.activateTabNav(r.closest(".switcher-nav-item")),this.form.querySelectorAll(".field-group").forEach(o=>this.desactivateTab(o)),this.activateTab(this.form.querySelector("#"+i))})}),this.classList.add("content-tabs-ready")}activateTab(e){e?.classList.add("active")}activateTabNav(e){e?.classList.add("active"),e?.setAttribute("aria-selected",!0)}desactivateTab(e){e?.classList.remove("active")}desactivateTabNav(e){e?.classList.remove("active"),e?.removeAttribute("aria-selected")}async onFormSubmit(e){e.preventDefault(),window.dispatchEvent(new CustomEvent("requestLoaderShow")),window.dispatchEvent(new CustomEvent("pagechange"));try{const t=await fetch(window.location.href,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams(new FormData(this.form))});if(!t.ok)throw t;const s=await t.json();this.cleanErrors(),s.public_url&&document.querySelectorAll("a.public-url-link").forEach(r=>r.setAttribute("href",s.public_url)),s.preview_url&&document.querySelectorAll("a.preview-url-link").forEach(r=>r.setAttribute("href",s.preview_url))}catch(t){const s=await t.json();s.errors&&(this.displayErrors(s.errors),window.dispatchEvent(new CustomEvent("pushToast",{detail:{message:s.message,status:"danger"}})))}return window.dispatchEvent(new CustomEvent("requestLoaderHide")),window.dispatchEvent(new CustomEvent("requestAllNodeTreeChange")),!1}cleanErrors(){document.querySelectorAll(".form-errored").forEach(t=>{t.classList.remove("form-errored"),t.querySelector(".error-message").remove()})}displayErrors(e,t=!1,s=""){(!t||t===!1)&&this.cleanErrors(),Object.keys(e).forEach(r=>{const i=e[r];if(Array.isArray(i)){i.forEach((a,c)=>{this.displayErrors(a,!0,s+r+"_"+c+"_")});return}if(h(i)==="string"){this.displaySingleError(s,r,e);return}if(h(i)!=="object")return;Object.keys(i).forEach(a=>{h(i[a])==="object"?this.displayErrors(i[a],!0,s+r+"_"+a+"_"):this.displaySingleError(s,a,i)})})}displaySingleError(e,t,s=[]){const n="source_"+(e+t);let r="";Array.isArray(s[t])?r=s[t][0]:r=s[t];const i=document.getElementById(n);if(i){const o=i.closest(".uk-form-row");o&&(o.classList.add("form-errored"),o.insertAdjacentHTML("beforeend",`<p class="error-message uk-alert uk-alert-danger"><i class="uk-icon uk-icon-warning"></i> ${r}</p>`))}}onInputKeyDown(e){e.keyCode===18&&document.body.classList.toggle("dev-name-visible")}onInputKeyUp(e){e.keyCode===18&&document.body.classList.toggle("dev-name-visible")}childrenNodeWidgetFlip(e){e>=this.formRow.length-2&&(this.dropdown=this.formRow[e].querySelector(".uk-dropdown-small"),this.dropdown.classList.add("uk-dropdown-up"))}inputFocus(e){e.currentTarget.parentElement.classList.add("form-col-focus")}inputFocusOut(e){e.currentTarget.parentElement.classList.remove("form-col-focus")}}export{w as default};
