import{t as h}from"./main-DGjv1Oz9.js";import"./jquery-Cs7-jZ1a.js";import"./vue-BqDQd3Vv.js";class w extends HTMLElement{constructor(){super(),this.onInputKeyDown=this.onInputKeyDown.bind(this),this.onInputKeyUp=this.onInputKeyUp.bind(this),this.inputFocus=this.inputFocus.bind(this),this.inputFocusOut=this.inputFocusOut.bind(this),this.onFormSubmit=this.onFormSubmit.bind(this),this.wrapInTabs=this.wrapInTabs.bind(this),this.dropdown=null,this.form=this.querySelector("#edit-node-source-form"),this.formRow=this.querySelectorAll(".uk-form-row"),this.input=this.querySelectorAll("input, select"),this.devNames=this.querySelectorAll("[data-dev-name]")}connectedCallback(){this.form&&(this.wrapInTabs(),this.devNames.forEach(e=>{if(e.getAttribute("data-dev-name")!==""){const t=e.closest(".uk-form-row").querySelector("label"),r=e.querySelector(".uk-navbar-brand.label");t?t.insertAdjacentHTML("beforeend",'<span class="field-dev-name">'+e.getAttribute("data-dev-name")+"</span>"):r&&r.insertAdjacentHTML("beforeend",'<span class="field-dev-name">'+e.getAttribute("data-dev-name")+"</span>")}}),this.formRow.forEach((e,t)=>{e.className.indexOf("children-nodes-widget")>=0&&this.childrenNodeWidgetFlip(t)}),window.addEventListener("keydown",this.onInputKeyDown),window.addEventListener("keyup",this.onInputKeyUp),this.input.forEach(e=>{e.addEventListener("focus",this.inputFocus),e.addEventListener("focusout",this.inputFocusOut)}),this.form.addEventListener("submit",this.onFormSubmit))}disconnectedCallback(){this.form&&(window.removeEventListener("keydown",this.onInputKeyDown),window.removeEventListener("keyup",this.onInputKeyUp),this.input.forEach(e=>{e.removeEventListener("focus",this.inputFocus),e.removeEventListener("focusout",this.inputFocusOut)}),this.form.removeEventListener("submit",this.onFormSubmit))}wrapInTabs(){let e={default:{name:"default",id:"default",fields:[]}},t=this.querySelectorAll(".uk-form-row[data-field-group-canonical]");const r=t.length;let n=1;if(r<=0){this.classList.add("content-tabs-ready");return}for(let s=0;s<r;s++){let o=t[s].getAttribute("data-field-group"),i=t[s].getAttribute("data-field-group-canonical");i?(typeof e[i]>"u"&&(e[i]={name:o,id:i,fields:[]},n++),e[i].fields.push(t[s])):e.default.fields.push(t[s])}if(n>1){this.form.insertAdjacentHTML("beforeend",'<div id="node-source-form-switcher-nav-cont"><nav role="tablist" id="node-source-form-switcher-nav"></nav></div><ul id="node-source-form-switcher"></ul>');const s=this.form.querySelector("#node-source-form-switcher"),o=this.form.querySelector("#node-source-form-switcher-nav");for(let i in e){const a=e[i],c=a.id.replace(/[\s_]/g,"-").replace(/[^\w-]+/g,""),d="group-"+c,l="tab-"+c;s.insertAdjacentHTML("beforeend",'<li role="tabpanel" aria-labelledby="'+l+'" class="field-group" id="'+d+'"></li>'),a.id==="default"?o.insertAdjacentHTML("beforeend",'<button id="'+l+'" role="tab" class="switcher-nav-item" type="button" aria-controls="'+d+'"><i class="uk-icon-star"></i></button>'):o.insertAdjacentHTML("beforeend",'<button id="'+l+'" role="tab" class="switcher-nav-item" type="button" aria-controls="'+d+'">'+a.name+"</button>");let f=s.querySelector("#"+d);for(let u=0;u<a.fields.length;u++)f.appendChild(a.fields[u])}}this.activateTab(this.form.querySelector("#group-default")),this.activateTabNav(this.form.querySelector(".switcher-nav-item")),this.form.querySelectorAll(".switcher-nav-item").forEach(s=>{s.addEventListener("click",()=>{const o=s.getAttribute("aria-controls");this.form.querySelectorAll(".switcher-nav-item").forEach(i=>this.desactivateTabNav(i)),this.activateTabNav(s.closest(".switcher-nav-item")),this.form.querySelectorAll(".field-group").forEach(i=>this.desactivateTab(i)),this.activateTab(this.form.querySelector("#"+o))})}),this.classList.add("content-tabs-ready")}activateTab(e){e?.classList.add("active")}activateTabNav(e){e?.classList.add("active"),e?.setAttribute("aria-selected",!0)}desactivateTab(e){e?.classList.remove("active")}desactivateTabNav(e){e?.classList.remove("active"),e?.removeAttribute("aria-selected")}async onFormSubmit(e){e.preventDefault(),window.dispatchEvent(new CustomEvent("requestLoaderShow")),window.dispatchEvent(new CustomEvent("pagechange"));try{const t=await fetch(window.location.href,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams(new FormData(this.form))});if(!t.ok)throw t;this.cleanErrors()}catch(t){const r=await t.json();r.errors&&(this.displayErrors(r.errors),window.dispatchEvent(new CustomEvent("pushToast",{detail:{message:r.message,status:"danger"}})))}return window.dispatchEvent(new CustomEvent("requestLoaderHide")),window.dispatchEvent(new CustomEvent("requestAllNodeTreeChange")),!1}cleanErrors(){document.querySelectorAll(".form-errored").forEach(t=>{t.classList.remove("form-errored"),t.querySelector(".error-message").remove()})}displayErrors(e,t=!1,r=""){(!t||t===!1)&&this.cleanErrors(),Object.keys(e).forEach(s=>{const o=e[s];if(Array.isArray(o)){o.forEach((a,c)=>{this.displayErrors(a,!0,r+s+"_"+c+"_")});return}if(h(o)==="string"){this.displaySingleError(r,s,e);return}if(h(o)!=="object")return;Object.keys(o).forEach(a=>{h(o[a])==="object"?this.displayErrors(o[a],!0,r+s+"_"+a+"_"):this.displaySingleError(r,a,o)})})}displaySingleError(e,t,r=[]){const n="source_"+(e+t);let s="";Array.isArray(r[t])?s=r[t][0]:s=r[t];const o=document.getElementById(n);if(o){const i=o.closest(".uk-form-row");i&&(i.classList.add("form-errored"),i.insertAdjacentHTML("beforeend",`<p class="error-message uk-alert uk-alert-danger"><i class="uk-icon uk-icon-warning"></i> ${s}</p>`))}}onInputKeyDown(e){e.keyCode===18&&document.body.classList.toggle("dev-name-visible")}onInputKeyUp(e){e.keyCode===18&&document.body.classList.toggle("dev-name-visible")}childrenNodeWidgetFlip(e){e>=this.formRow.length-2&&(this.dropdown=this.formRow[e].querySelector(".uk-dropdown-small"),this.dropdown.classList.add("uk-dropdown-up"))}inputFocus(e){e.currentTarget.parentElement.classList.add("form-col-focus")}inputFocusOut(e){e.currentTarget.parentElement.classList.remove("form-col-focus")}}export{w as default};
