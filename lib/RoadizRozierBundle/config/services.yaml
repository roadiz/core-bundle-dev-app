---
services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
        bind:
            $backofficeMenuEntries: '%roadiz_rozier.backoffice_menu_configuration%'
            $documentPlatforms: '%roadiz_core.medias.supported_platforms%'
            $customPublicScheme: '%roadiz_core.custom_public_scheme%'
            $customPreviewScheme: '%roadiz_core.custom_preview_scheme%'
            $nodeFormTypeClass: '%roadiz_rozier.node_form.class%'
            $addNodeFormTypeClass: '%roadiz_rozier.add_node_form.class%'
            $googleServerId: '%roadiz_core.medias.google_server_id%'
            $soundcloudClientId: '%roadiz_core.medias.soundcloud_client_id%'
            $forceSslOnRedirectUri: '%roadiz_rozier.open_id.force_ssl_on_redirect_uri%'
            $useGravatar: '%roadiz_core.use_gravatar%'
            $csvEncoderOptions: '%roadiz_rozier.csv_encoder_options%'

    RZ\Roadiz\RozierBundle\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Event/'
            - '../src/Kernel.php'
            - '../src/Model/'
            - '../src/Explorer/'
            - '../src/Tests/'
            - '../src/Widgets/'

    RZ\Roadiz\RozierBundle\Explorer\Provider\:
        resource: '../src/Explorer/Provider/'
        autowire: true
        autoconfigure: true
        tags: [ 'roadiz.explorer_provider' ]

    RZ\Roadiz\CoreBundle\Explorer\ExplorerItemFactoryInterface:
        class: RZ\Roadiz\RozierBundle\Explorer\ExplorerItemFactory
        autowire: true
        autoconfigure: true

    RZ\Roadiz\RozierBundle\Widget\TreeWidgetFactory: ~
    RZ\Roadiz\RozierBundle\RozierServiceRegistry:
        public: true

    RZ\Roadiz\RozierBundle\Breadcrumbs\BreadcrumbsItemFactoryInterface:
        class: RZ\Roadiz\RozierBundle\Breadcrumbs\BreadcrumbsItemFactory
        autowire: true
        autoconfigure: true

    roadiz_rozier.twig_loader:
        class: Twig\Loader\FilesystemLoader
        calls:
            -   prependPath: [ '%roadiz_core.documents_lib_dir%/Resources/views' ]
        tags: [ 'twig.loader' ]

    #
    # Open ID
    #
    RZ\Roadiz\OpenId\OAuth2LinkGenerator:
        arguments:
            - '@?roadiz_rozier.open_id.discovery'
            - '@security.csrf.token_manager'
            - '@RZ\Roadiz\Random\TokenGeneratorInterface'
            - '%roadiz_rozier.open_id.hosted_domain%'
            - '%roadiz_rozier.open_id.oauth_client_id%'
            - '%roadiz_rozier.open_id.scopes%'

    RZ\Roadiz\OpenId\Authentication\Provider\SettingsRoleStrategy:
        arguments: [ '@RZ\Roadiz\CoreBundle\Bag\Settings' ]
        tags: [ 'roadiz_rozier.jwt_role_strategy' ]

    RZ\Roadiz\OpenId\Authentication\Provider\ChainJwtRoleStrategy: ~
    RZ\Roadiz\OpenId\Authentication\Provider\OpenIdAccountProvider: ~

    RZ\Roadiz\RozierBundle\Controller\PingController:
        arguments: ['@?profiler']

