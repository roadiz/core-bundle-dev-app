import{t as h}from"./main-BbLlNws5.js";import"./jquery-5sAwpjfl.js";import"./vue-YhlLoeNc.js";class w extends HTMLElement{constructor(){super(),this.onInputKeyDown=this.onInputKeyDown.bind(this),this.onInputKeyUp=this.onInputKeyUp.bind(this),this.inputFocus=this.inputFocus.bind(this),this.inputFocusOut=this.inputFocusOut.bind(this),this.onFormSubmit=this.onFormSubmit.bind(this),this.wrapInTabs=this.wrapInTabs.bind(this),this.dropdown=null,this.form=this.querySelector("#edit-node-source-form"),this.formRow=this.querySelectorAll(".uk-form-row"),this.input=this.querySelectorAll("input, select"),this.devNames=this.querySelectorAll("[data-dev-name]")}connectedCallback(){this.form&&(this.wrapInTabs(),this.devNames.forEach(t=>{if(t.getAttribute("data-dev-name")!==""){const e=t.closest(".uk-form-row").querySelector("label"),s=t.querySelector(".uk-navbar-brand.label");e?e.insertAdjacentHTML("beforeend",'<span class="field-dev-name">'+t.getAttribute("data-dev-name")+"</span>"):s&&s.insertAdjacentHTML("beforeend",'<span class="field-dev-name">'+t.getAttribute("data-dev-name")+"</span>")}}),this.formRow.forEach((t,e)=>{t.className.indexOf("children-nodes-widget")>=0&&this.childrenNodeWidgetFlip(e)}),window.addEventListener("keydown",this.onInputKeyDown),window.addEventListener("keyup",this.onInputKeyUp),this.input.forEach(t=>{t.addEventListener("focus",this.inputFocus),t.addEventListener("focusout",this.inputFocusOut)}),this.form.addEventListener("submit",this.onFormSubmit))}disconnectedCallback(){this.form&&(window.removeEventListener("keydown",this.onInputKeyDown),window.removeEventListener("keyup",this.onInputKeyUp),this.input.forEach(t=>{t.removeEventListener("focus",this.inputFocus),t.removeEventListener("focusout",this.inputFocusOut)}),this.form.removeEventListener("submit",this.onFormSubmit))}wrapInTabs(){let t={default:{name:"default",id:"default",fields:[]}},e=this.querySelectorAll(".uk-form-row[data-field-group-canonical]");const s=e.length;let n=1;if(s<=0){this.classList.add("content-tabs-ready");return}for(let r=0;r<s;r++){let i=e[r].getAttribute("data-field-group"),a=e[r].getAttribute("data-field-group-canonical");a?(typeof t[a]>"u"&&(t[a]={name:i,id:a,fields:[]},n++),t[a].fields.push(e[r])):t.default.fields.push(e[r])}if(n>1){this.form.insertAdjacentHTML("beforeend",'<div id="node-source-form-switcher-nav-cont"><nav role="tablist" id="node-source-form-switcher-nav"></nav></div><ul id="node-source-form-switcher"></ul>');const r=this.form.querySelector("#node-source-form-switcher"),i=this.form.querySelector("#node-source-form-switcher-nav");for(let a in t){const o=t[a],c=o.id.replace(/[\s_]/g,"-").replace(/[^\w-]+/g,""),d="group-"+c,u="tab-"+c;r.insertAdjacentHTML("beforeend",'<li role="tabpanel" aria-labelledby="'+u+'" class="field-group" id="'+d+'"></li>'),o.id==="default"?i.insertAdjacentHTML("beforeend",'<button id="'+u+'" role="tab" class="switcher-nav-item" type="button" aria-controls="'+d+'"><i class="uk-icon-star"></i></button>'):i.insertAdjacentHTML("beforeend",'<button id="'+u+'" role="tab" class="switcher-nav-item" type="button" aria-controls="'+d+'">'+o.name+"</button>");let f=r.querySelector("#"+d);for(let l=0;l<o.fields.length;l++)f.appendChild(o.fields[l])}}this.activateTab(this.form.querySelector("#group-default")),this.activateTabNav(this.form.querySelector(".switcher-nav-item")),this.form.querySelectorAll(".switcher-nav-item").forEach(r=>{r.addEventListener("click",i=>{const a=r.getAttribute("aria-controls");this.form.querySelectorAll(".switcher-nav-item").forEach(o=>this.desactivateTabNav(o)),this.activateTabNav(r.closest(".switcher-nav-item")),this.form.querySelectorAll(".field-group").forEach(o=>this.desactivateTab(o)),this.activateTab(this.form.querySelector("#"+a))})}),this.classList.add("content-tabs-ready")}activateTab(t){t==null||t.classList.add("active")}activateTabNav(t){t==null||t.classList.add("active"),t==null||t.setAttribute("aria-selected",!0)}desactivateTab(t){t==null||t.classList.remove("active")}desactivateTabNav(t){t==null||t.classList.remove("active"),t==null||t.removeAttribute("aria-selected")}async onFormSubmit(t){t.preventDefault(),window.dispatchEvent(new CustomEvent("requestLoaderShow")),window.dispatchEvent(new CustomEvent("pagechange"));try{const e=await fetch(window.location.href,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams(new FormData(this.form))});if(!e.ok)throw e;const s=await e.json();this.cleanErrors(),s.public_url&&document.querySelectorAll("a.public-url-link").forEach(r=>r.setAttribute("href",s.public_url)),s.preview_url&&document.querySelectorAll("a.preview-url-link").forEach(r=>r.setAttribute("href",s.preview_url))}catch(e){const s=await e.json();s.errors&&(this.displayErrors(s.errors),window.dispatchEvent(new CustomEvent("pushToast",{detail:{message:s.message,status:"danger"}})))}return window.dispatchEvent(new CustomEvent("requestLoaderHide")),window.dispatchEvent(new CustomEvent("requestAllNodeTreeChange")),!1}cleanErrors(){document.querySelectorAll(".form-errored").forEach(e=>{e.classList.remove("form-errored"),e.querySelector(".error-message").remove()})}displayErrors(t,e=!1,s=""){(!e||e===!1)&&this.cleanErrors(),Object.keys(t).forEach(r=>{const i=t[r];if(Array.isArray(i)){i.forEach((o,c)=>{this.displayErrors(o,!0,s+r+"_"+c+"_")});return}if(h(i)==="string"){this.displaySingleError(s,r,t);return}if(h(i)!=="object")return;Object.keys(i).forEach(o=>{h(i[o])==="object"?this.displayErrors(i[o],!0,s+r+"_"+o+"_"):this.displaySingleError(s,o,i)})})}displaySingleError(t,e,s=[]){const n="source_"+(t+e);let r="";Array.isArray(s[e])?r=s[e][0]:r=s[e];const i=document.getElementById(n);if(i){const a=i.closest(".uk-form-row");a&&(a.classList.add("form-errored"),a.insertAdjacentHTML("beforeend",`<p class="error-message uk-alert uk-alert-danger"><i class="uk-icon uk-icon-warning"></i> ${r}</p>`))}}onInputKeyDown(t){t.keyCode===18&&document.body.classList.toggle("dev-name-visible")}onInputKeyUp(t){t.keyCode===18&&document.body.classList.toggle("dev-name-visible")}childrenNodeWidgetFlip(t){t>=this.formRow.length-2&&(this.dropdown=this.formRow[t].querySelector(".uk-dropdown-small"),this.dropdown.classList.add("uk-dropdown-up"))}inputFocus(t){t.currentTarget.parentElement.classList.add("form-col-focus")}inputFocusOut(t){t.currentTarget.parentElement.classList.remove("form-col-focus")}}export{w as default};
